<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saif TV - Ø³ÙŠÙ ØªÙŠ ÙÙŠ</title>
    <style>
        :root {
            --primary-color: #0f0f0f; --secondary-color: #222222;
            --text-color: #ffffff; --accent-color: #e50914;
        }
        body {
            font-family: 'Tajawal', sans-serif; margin: 0; color: var(--text-color);
            background-color: var(--primary-color);
            background-image: url('https://www.transparenttextures.com/patterns/dark-circles.png');
            overflow-x: hidden;
        }
        /* --- Header --- */
        header { background-color: rgba(15, 15, 15, 0.85); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: fixed; width: 90%; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .logo { font-size: 2.5em; font-weight: bold; color: var(--accent-color); }
        .nav-links a { color: var(--text-color); text-decoration: none; margin: 0 15px; font-size: 1.1em; transition: color 0.3s; }
        .nav-links a:hover { color: var(--accent-color); }

        /* --- Main Banner & Category Sliders --- */
        .slider-container { width: 100%; overflow: hidden; cursor: grab; }
        .slider-container:active { cursor: grabbing; }
        .slider { display: flex; }
        .banner-container { margin-top: 100px; padding: 20px 0; }
        .banner-slider { animation: banner-slide 40s linear infinite; }
        .banner-slider:hover, .series-carousel:hover { animation-play-state: paused; }
        .banner-item { flex-shrink: 0; width: 600px; margin: 0 10px; border-radius: 15px; overflow: hidden; cursor: pointer; }
        .banner-item img { width: 100%; height: 340px; object-fit: cover; display: block; }
        .category-section { padding: 20px 0; }
        .category-title { font-size: 1.8em; font-weight: bold; margin: 0 5% 15px; }
        .series-carousel-container { padding: 0 5%; }
        .series-card-small { flex-shrink: 0; width: 170px; margin-left: 15px; transition: transform 0.2s; cursor: pointer; }
        .series-card-small:hover { transform: scale(1.08); }
        .series-card-small img { width: 100%; height: 250px; object-fit: cover; border-radius: 12px; }
        .series-card-small .title { padding: 8px; text-align: center; font-size: 0.95em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        @keyframes banner-slide { from { transform: translateX(0%); } to { transform: translateX(-100%); } }

        /* --- Fullscreen Views (Details & Episode) --- */
        .fullscreen-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000;
            transform: translateX(100%); transition: transform 0.4s ease-in-out;
            overflow-y: auto; background-color: var(--primary-color);
        }
        .fullscreen-view.active { transform: translateX(0); }
        .view-background { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; filter: blur(10px) brightness(0.4); z-index: -1; }
        .view-header { padding: 20px; display: flex; align-items: center; background: rgba(0,0,0,0.5); }
        .back-button { font-size: 2em; cursor: pointer; margin-left: 20px; }
        .view-content { padding: 20px; }
        
        /* Details View Specifics */
        .series-main-info { display: flex; gap: 25px; flex-wrap: wrap; }
        .series-main-info img { width: 220px; height: 330px; border-radius: 10px; object-fit: cover; }
        .series-main-info .text-info { flex: 1; }
        .series-main-info h1 { font-size: 2.5em; margin: 0 0 15px; }
        .episode-item { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 8px; cursor: pointer; }
        .episode-item img { width: 160px; height: 90px; border-radius: 5px; object-fit: cover; }
        .episode-item span { font-size: 1.1em; }
        
        /* Episode View Specifics */
        .video-player-container { width: 100%; max-width: 900px; margin: 0 auto 20px; aspect-ratio: 16 / 9; }
        .video-player-container iframe { width: 100%; height: 100%; border-radius: 10px; }
        .episode-info { text-align: center; margin-bottom: 30px; }
        .related-episodes-list .related-item { padding: 12px; background: rgba(0,0,0,0.3); border-radius: 5px; margin-bottom: 8px; }
        .recommendations-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 15px; margin-top: 30px; }
        
        /* --- Footer --- */
        footer { background: #1a1a1a; padding: 40px 5%; margin-top: 30px; color: #aaa; }
        .footer-content { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 30px; }
        .footer-section { flex: 1; min-width: 250px; }
        .footer-section h3 { color: white; margin-bottom: 15px; }
        .footer-section a { color: var(--accent-color); text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .copyright { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #333; }
        
        /* --- Mobile Responsive --- */
        @media (max-width: 768px) {
            .logo { font-size: 1.8em; } .nav-links { display: none; }
            .banner-item { width: 90vw; } .banner-item img { height: 200px; }
            .series-card-small { width: 140px; } .series-card-small img { height: 200px; }
            .series-main-info, .episode-item { flex-direction: column; } .series-main-info img { width: 100%; height: auto; }
            .recommendations-grid { grid-template-columns: repeat(2, 1fr); } /* 2 columns on mobile */
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header><div class="logo">Saif TV</div></header>

    <main id="main-content">
        <section class="banner-container slider-container" id="banner-container">
            <div class="banner-slider slider" id="banner-slider-content"></div>
        </section>
    </main>

    <div class="fullscreen-view" id="details-view">
        <div class="view-background" id="details-view-background"></div>
        <div class="view-header"><span class="back-button" id="back-button-details">â¡ï¸</span></div>
        <div class="view-content" id="details-content-container"></div>
    </div>
    
    <div class="fullscreen-view" id="episode-view">
        <div class="view-background" id="episode-view-background"></div>
        <div class="view-header"><span class="back-button" id="back-button-episode">â¡ï¸</span></div>
        <div class="view-content" id="episode-content-container"></div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Ø¹Ù† Saif TV</h3>
                <p>Ù…ÙˆÙ‚Ø¹ Ø³ÙŠÙ ØªÙŠ ÙÙŠ Ù‡Ùˆ ÙˆØ¬Ù‡ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©.</p>
            </div>
            <div class="footer-section">
                <h3>Ø±ÙˆØ§Ø¨Ø· Ù…Ù‡Ù…Ø©</h3>
                <p><a href="#">ğŸ“œ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a></p>
                <p><a href="#">âš–ï¸ Ø´Ø±ÙˆØ· Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</a></p>
                <p><a href="#">Â©ï¸ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù†Ø´Ø± (DMCA)</a></p>
            </div>
            <div class="footer-section">
                <h3>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3>
                <p>Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø£Ùˆ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ù…Ø´ÙƒÙ„Ø©:</p>
                <p><a href="https://wa.me/YOUR_WHATSAPP_NUMBER" target="_blank">
                    <svg height="20" viewBox="0 0 24 24"><path fill="currentColor" d="M12.04 2C6.58 2 2.13 6.45 2.13 11.91C2.13 13.66 2.59 15.36 3.45 16.86L2.05 22L7.3 20.62C8.75 21.41 10.37 21.82 12.04 21.82C17.5 21.82 21.95 17.37 21.95 11.91C21.95 6.45 17.5 2 12.04 2M12.04 3.67C16.56 3.67 20.28 7.38 20.28 11.91C20.28 16.44 16.56 20.15 12.04 20.15C10.56 20.15 9.14 19.78 7.9 19.09L7.54 18.88L4.32 19.8L5.26 16.68L5.04 16.3C4.32 15.05 3.8 13.53 3.8 11.91C3.8 7.38 7.52 3.67 12.04 3.67M16.57 14.45C16.31 14.71 15.35 15.24 15.08 15.37C14.82 15.5 14.49 15.53 14.2 15.37C13.91 15.21 13.04 14.92 12.03 14C10.82 12.89 10.15 11.64 9.96 11.35C9.77 11.06 9.89 10.92 10.04 10.77C10.17 10.64 10.32 10.46 10.46 10.3C10.6 10.14 10.66 10.01 10.8 9.78C10.94 9.55 10.88 9.32 10.81 9.2C10.75 9.08 10.27 7.82 10.06 7.34C9.85 6.86 9.64 6.91 9.48 6.91C9.31 6.91 9.04 6.91 8.78 6.91C8.52 6.91 8.1 6.97 7.77 7.29C7.44 7.61 6.78 8.24 6.78 9.43C6.78 10.62 7.8 11.75 7.94 11.91C8.08 12.07 9.77 14.64 12.33 15.79C14.15 16.59 14.89 16.29 15.38 16.23C15.87 16.17 16.75 15.65 16.94 15.06C17.13 14.47 17.13 13.98 17.07 13.89C17 13.8 16.83 13.74 16.57 13.48" /></svg>
                    ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                </a></p>
            </div>
        </div>
        <div class="copyright">&copy; 2025 Saif TV. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
    </footer>


    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

      // --- CONFIG & GLOBAL VARS ---
      const firebaseConfig = { apiKey: "AIzaSyCsnZdFrg-KlWFc0z6OgmXgBp6lPKf14fU", authDomain: "saifsa-b51f1.firebaseapp.com", databaseURL: "https://saifsa-b51f1-default-rtdb.europe-west1.firebasedatabase.app", projectId: "saifsa-b51f1", storageBucket: "saifsa-b51f1.firebasestorage.app", messagingSenderId: "41089917871", appId: "1:41089917871:web:fce49f6f23bd4f679b055a" };
      const YOUTUBE_API_KEY = 'AIzaSyA4gfRf5sGQZ-a7ficcTcgU47aJV30cSgc';
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      let seriesDataCache = {}; // Cache to store all series data by category

      // --- DOM ELEMENTS ---
      const mainContent = document.getElementById('main-content');
      const bannerSliderContent = document.getElementById('banner-slider-content');
      const detailsView = document.getElementById('details-view');
      const episodeView = document.getElementById('episode-view');
      
      // --- CORE LOGIC ---
      function fetchSeriesFromFirebase() {
        onValue(ref(database, 'series/'), (snapshot) => {
            document.querySelectorAll('.category-section').forEach(el => el.remove());
            bannerSliderContent.innerHTML = '';
            seriesDataCache = snapshot.val() || {};
            
            if (Object.keys(seriesDataCache).length > 0) {
                let allPlaylistIds = [];
                for (const categoryName in seriesDataCache) {
                    allPlaylistIds.push(...Object.values(seriesDataCache[categoryName]).map(item => item.playlistId));
                    createCategorySection(categoryName, seriesDataCache[categoryName]);
                }
                populateSlider(bannerSliderContent, allPlaylistIds, createBannerItem);
            }
        });
      }

      function createCategorySection(name, series) {
          const section = document.createElement('section'); section.className = 'category-section'; section.id = `category-${name}`;
          const title = document.createElement('h2'); title.className = 'category-title'; title.textContent = name;
          const carouselContainer = document.createElement('div'); carouselContainer.className = 'series-carousel-container slider-container';
          const carousel = document.createElement('div'); carousel.className = 'series-carousel slider';
          
          carouselContainer.appendChild(carousel); section.appendChild(title); section.appendChild(carouselContainer); mainContent.appendChild(section);
          
          const playlistIds = Object.values(series).map(item => item.playlistId);
          populateSlider(carousel, playlistIds, (id, info, container) => createSeriesCard(id, info, container, name));
          makeDraggable(carouselContainer);
      }
      
      async function populateSlider(container, playlistIds, createItemFunc) {
        const uniqueIds = [...new Set(playlistIds)]; // Ensure no duplicates
        for (const id of uniqueIds) {
            const info = await fetchApiData(`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${id}&key=${YOUTUBE_API_KEY}`);
            if (info) createItemFunc(id, info, container);
        }
        // Create seamless loop after all original items are added
        if (container.children.length > 0) {
            Array.from(container.children).forEach(item => container.appendChild(item.cloneNode(true)));
        }
      }

      async function fetchApiData(url) {
          try {
              const response = await fetch(url);
              if (!response.ok) throw new Error(`Network error: ${response.status}`);
              const data = await response.json();
              return (data.items && data.items.length > 0) ? data : null;
          } catch (error) { console.error("YouTube API Error:", error); return null; }
      }

      // --- ITEM CREATION ---
      function createBannerItem(id, info, container) {
          const playlist = info.items[0].snippet;
          const imageUrl = playlist.thumbnails.maxres?.url || playlist.thumbnails.high.url;
          const item = document.createElement('div'); item.className = 'banner-item';
          item.onclick = () => openDetailsView(id, imageUrl, "Unknown"); // Category isn't needed here
          item.innerHTML = `<img src="${imageUrl}" alt="${playlist.title}" loading="lazy">`;
          container.appendChild(item);
      }

      function createSeriesCard(id, info, container, categoryName) {
          const playlist = info.items[0].snippet;
          const imageUrl = playlist.thumbnails.high.url;
          const card = document.createElement('div'); card.className = 'series-card-small';
          card.onclick = () => openDetailsView(id, imageUrl, categoryName);
          card.innerHTML = `<img src="${imageUrl}" alt="${playlist.title}" loading="lazy"><div class="title">${playlist.title}</div>`;
          container.appendChild(card);
      }

      // --- VIEW MANAGEMENT ---
      async function openDetailsView(playlistId, imageUrl, categoryName) {
          showView(detailsView, imageUrl, '<h2>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>');
          const seriesInfoData = await fetchApiData(`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${playlistId}&key=${YOUTUBE_API_KEY}`);
          const itemsData = await fetchApiData(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}&maxResults=50`);
          
          if (!seriesInfoData || !itemsData) { updateViewContent(detailsView, "<h2>Ø®Ø·Ø£</h2><p>Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„.</p>"); return; }
          
          const seriesInfo = seriesInfoData.items[0].snippet;
          const episodesHtml = itemsData.items.map(item => {
              const ep = item.snippet;
              return `<div class="episode-item" onclick="openEpisodeView('${playlistId}', '${ep.resourceId.videoId}', '${imageUrl}', '${categoryName}')">
                          <img src="${ep.thumbnails.medium.url}" alt="${ep.title}"><span>${ep.title}</span>
                      </div>`;
          }).join('');

          updateViewContent(detailsView, `
              <div class="series-main-info">
                  <img src="${imageUrl}" alt="${seriesInfo.title}">
                  <div class="text-info">
                      <h1>${seriesInfo.title}</h1>
                      <button class="share-button" onclick="shareContent('series', '${playlistId}')">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ©</button>
                      <iframe width="100%" height="315" src="https://www.youtube.com/embed/videoseries?list=${playlistId}" style="margin-top:20px; border-radius:10px;" frameborder="0" allowfullscreen></iframe>
                  </div>
              </div>
              <div class="episodes-list"><h2>Ø§Ù„Ø­Ù„Ù‚Ø§Øª</h2>${episodesHtml}</div>`);
      }
      
      async function openEpisodeView(playlistId, videoId, imageUrl, categoryName) {
          showView(episodeView, imageUrl, '<h2>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h2>');
          const itemsData = await fetchApiData(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}&maxResults=50`);
          const currentEpisode = itemsData?.items.find(i => i.snippet.resourceId.videoId === videoId)?.snippet;
          
          if (!currentEpisode) { updateViewContent(episodeView, "<h2>Ø®Ø·Ø£</h2><p>Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ù„Ù‚Ø©.</p>"); return; }
          
          const relatedEpisodesHtml = itemsData.items.map((item, index) =>
              `<div class="related-item">${index + 1}. ${item.snippet.title}</div>`
          ).join('');

          let recommendationsHtml = '';
          if (seriesDataCache[categoryName]) {
              recommendationsHtml = Object.values(seriesDataCache[categoryName])
                  .filter(series => series.playlistId !== playlistId)
                  .slice(0, 6) // Limit to 6 recommendations
                  .map(series => `<div class="series-card-small" onclick="openDetailsView('${series.playlistId}', '', '${categoryName}')" id="rec-${series.playlistId}"></div>`)
                  .join('');
          }

          updateViewContent(episodeView, `
              <div class="video-player-container"><iframe src="https://www.youtube.com/embed/${videoId}?list=${playlistId}&autoplay=1" allowfullscreen></iframe></div>
              <div class="episode-info">
                  <h2>${currentEpisode.title}</h2>
                  <button class="share-button" onclick="shareContent('episode', '${playlistId}', '${videoId}')">ğŸ”— Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø­Ù„Ù‚Ø©</button>
              </div>
              <div class="related-episodes-list"><h3>Ø­Ù„Ù‚Ø§Øª Ø£Ø®Ø±Ù‰</h3>${relatedEpisodesHtml}</div>
              <div class="recommendations-grid">${recommendationsHtml}</div>`);
          
          // Asynchronously load recommendation images
          if (recommendationsHtml) {
              document.querySelectorAll('[id^="rec-"]').forEach(async placeholder => {
                  const pId = placeholder.id.replace('rec-', '');
                  const info = await fetchApiData(`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${pId}&key=${YOUTUBE_API_KEY}`);
                  if (info) placeholder.innerHTML = `<img src="${info.items[0].snippet.thumbnails.high.url}"><div class="title">${info.items[0].snippet.title}</div>`;
              });
          }
      }

      function showView(view, bgImageUrl, loadingMessage) {
          view.querySelector('.view-content').innerHTML = `<div style="text-align:center; padding:40px;">${loadingMessage}</div>`;
          view.querySelector('.view-background').style.backgroundImage = `url(${bgImageUrl})`;
          view.classList.add('active');
      }
      
      function updateViewContent(view, html) {
          view.querySelector('.view-content').innerHTML = html;
      }

      function closeView(view) { view.classList.remove('active'); }
      document.getElementById('back-button-details').onclick = () => closeView(detailsView);
      document.getElementById('back-button-episode').onclick = () => closeView(episodeView);
      
      // --- UTILITIES ---
      window.shareContent = (type, playlistId, videoId = null) => {
          let url = `${window.location.origin}${window.location.pathname}#series=${playlistId}`;
          if (type === 'episode' && videoId) url += `&video=${videoId}`;
          navigator.clipboard.writeText(url).then(() => alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©!'));
      }
      
      function makeDraggable(element) {
          let isDown = false, startX, scrollLeft;
          element.addEventListener('mousedown', (e) => { isDown = true; startX = e.pageX - element.offsetLeft; scrollLeft = element.scrollLeft; });
          element.addEventListener('mouseleave', () => isDown = false); element.addEventListener('mouseup', () => isDown = false);
          element.addEventListener('mousemove', (e) => {
              if (!isDown) return; e.preventDefault();
              element.scrollLeft = scrollLeft - ((e.pageX - element.offsetLeft) - startX) * 2;
          });
      }
      
      // --- INITIALIZATION ---
      fetchSeriesFromFirebase();
      makeDraggable(document.getElementById('banner-container'));
      
      // Allow global access to functions called from inline onclick
      window.openDetailsView = openDetailsView;
      window.openEpisodeView = openEpisodeView;
    </script>
</body>
</html>
